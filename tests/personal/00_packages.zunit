#!/usr/bin/env zunit

@setup {
  if [[ $CI_USAGE != "personal" ]]; then
    skip "Skipping test, not in personal CI environment"
  fi
}

@test 'Personal - Packages 00.1: Brew packages are installed' {
  packages_array_length=`yq e ".packages.cli.brew.personal | length - 1" home/.chezmoidata/packages.yml`

  run brew list

  for element_index in `seq 0 $packages_array_length`;do
    package=`yq e ".packages.cli.brew.personal[$element_index]" home/.chezmoidata/packages.yml`

    assert "$output" contains $package
  done
}

@test 'Personal - Packages 00.1: Work Brew packages are installed' {
  packages_array_length=`yq e ".packages.cli.brew.work | length - 1" home/.chezmoidata/packages.yml`

  run brew list

  for element_index in `seq 0 $packages_array_length`;do
    package=`yq e ".packages.cli.brew.work[$element_index]" home/.chezmoidata/packages.yml`

    assert "$output" does_not_contain $package
  done
}
