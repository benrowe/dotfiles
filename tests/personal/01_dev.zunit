#!/usr/bin/env zunit

@setup {
  if [[ $CI_USAGE != "personal" ]]; then
    skip "Skipping test, not in personal CI environment"
  fi
}

@test 'Personal - Dev 01.1: Personal dev folder exists' {
  assert ~/dev/src/github.com/twitchel is_dir
}

@test 'Personal - Dev 01.2: gitconfig set with personal email' {
  personal_email=$(chezmoi data | jq -r .details.personal.email)
  run git config --get user.email

  assert "$output" same_as "$personal_email"
}

@test 'Personal - Dev 01.3: personal gitconfig exists in personal dev folder' {
  assert ~/dev/src/github.com/twitchel/.gitconfig is_file

  run cat ~/dev/src/github.com/twitchel/.gitconfig

  assert_output_contains "email = $(chezmoi data | jq -r .details.personal.email)"
  assert_output_contains "name = $(chezmoi data | jq -r .details.personal.name)"
}